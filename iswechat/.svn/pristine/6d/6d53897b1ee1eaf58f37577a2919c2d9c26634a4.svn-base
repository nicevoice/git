<?php
namespace Home\Model;

use Think\Model;

class QuestionModel extends Model {
    protected $tablePrefix = 'cms_';
    protected $tableName = 'exam_question';



    public function getQuestion2Key($key = null)
    {
        $where = $this->segmentKey($key);
        $data = M('cms_exam_question')->where($where)->field('questionid,subject,description,answerid')->find();
        if(!$data)$data = M('cms_exam_question')->order(" rand() ")->field('questionid,subject,description,answerid')->find();
        if($data){
            $data['op'] = M('cms_exam_question_option')->where("questionid={$data['questionid']}")->field('name,sort')->select();
            $data['as'] = M('cms_exam_question_answer')->where("answerid={$data['answerid']}")->field('answer')->find();
        }
        return $data;
    }

    private function segmentKey($key)
    {
        if (!$key)return null;
        $seg = new \SaeSegment();
        $key = $seg->segment($key, 1);

        $where = array();
        foreach ($key as $k){
            $where[]  = " subject LIKE '%{$k['word']}%'";
        }
        if ($where) {
            $where = implode(' or ', $where);
        }
        return $where;
    }


}